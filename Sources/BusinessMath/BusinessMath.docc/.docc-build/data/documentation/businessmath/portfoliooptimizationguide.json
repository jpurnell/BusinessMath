{"sections":[],"schemaVersion":{"major":0,"minor":3,"patch":0},"identifier":{"url":"doc:\/\/com.jpurnell.BusinessMath\/documentation\/BusinessMath\/PortfolioOptimizationGuide","interfaceLanguage":"swift"},"seeAlsoSections":[{"anchor":"Tutorials","generated":true,"title":"Tutorials","identifiers":["doc:\/\/com.jpurnell.BusinessMath\/documentation\/BusinessMath\/BuildingRevenueModel","doc:\/\/com.jpurnell.BusinessMath\/documentation\/BusinessMath\/FinancialStatementsGuide","doc:\/\/com.jpurnell.BusinessMath\/documentation\/BusinessMath\/BuildingFinancialReports","doc:\/\/com.jpurnell.BusinessMath\/documentation\/BusinessMath\/ScenarioAnalysisGuide","doc:\/\/com.jpurnell.BusinessMath\/documentation\/BusinessMath\/FinancialRatiosGuide","doc:\/\/com.jpurnell.BusinessMath\/documentation\/BusinessMath\/VisualizationGuide","doc:\/\/com.jpurnell.BusinessMath\/documentation\/BusinessMath\/DebtAndFinancingGuide","doc:\/\/com.jpurnell.BusinessMath\/documentation\/BusinessMath\/EquityFinancingGuide","doc:\/\/com.jpurnell.BusinessMath\/documentation\/BusinessMath\/LeaseAccountingGuide","doc:\/\/com.jpurnell.BusinessMath\/documentation\/BusinessMath\/LoanAmortization","doc:\/\/com.jpurnell.BusinessMath\/documentation\/BusinessMath\/InvestmentAnalysis","doc:\/\/com.jpurnell.BusinessMath\/documentation\/BusinessMath\/OptimizationGuide","doc:\/\/com.jpurnell.BusinessMath\/documentation\/BusinessMath\/ForecastingGuide","doc:\/\/com.jpurnell.BusinessMath\/documentation\/BusinessMath\/RealOptionsGuide","doc:\/\/com.jpurnell.BusinessMath\/documentation\/BusinessMath\/RiskAnalyticsGuide"]}],"hierarchy":{"paths":[["doc:\/\/com.jpurnell.BusinessMath\/documentation\/BusinessMath"]]},"abstract":[{"type":"text","text":"Build optimal investment portfolios using Modern Portfolio Theory and risk parity strategies."}],"metadata":{"title":"Portfolio Optimization","roleHeading":"Article","role":"article"},"kind":"article","primaryContentSections":[{"content":[{"level":2,"text":"Overview","type":"heading","anchor":"Overview"},{"inlineContent":[{"type":"text","text":"Portfolio optimization helps you build investment portfolios that maximize returns for a given level of risk, or minimize risk for a target return. BusinessMath implements Modern Portfolio Theory (Markowitz optimization) and Risk Parity allocation strategies."}],"type":"paragraph"},{"inlineContent":[{"type":"text","text":"This guide covers:"}],"type":"paragraph"},{"items":[{"content":[{"type":"paragraph","inlineContent":[{"text":"Building portfolios from historical returns","type":"text"}]}]},{"content":[{"inlineContent":[{"type":"text","text":"Calculating the efficient frontier"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"type":"text","text":"Optimizing for maximum Sharpe ratio"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"text":"Risk parity allocation","type":"text"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"type":"text","text":"Practical portfolio construction"}],"type":"paragraph"}]}],"type":"unorderedList"},{"level":2,"text":"Modern Portfolio Theory","type":"heading","anchor":"Modern-Portfolio-Theory"},{"inlineContent":[{"text":"Modern Portfolio Theory, developed by Harry Markowitz, shows how to combine assets to achieve optimal risk-return tradeoffs.","type":"text"}],"type":"paragraph"},{"level":3,"text":"Creating a Portfolio","type":"heading","anchor":"Creating-a-Portfolio"},{"syntax":"swift","code":["import BusinessMath","","\/\/ Historical returns for 3 assets (monthly data for 1 year)","let periods = (1...12).map { Period.month(year: 2024, month: $0) }","","let stockAReturns = [0.08, 0.05, -0.02, 0.10, 0.03, 0.07, 0.04, 0.06, -0.01, 0.09, 0.05, 0.08]","let stockBReturns = [0.06, 0.04, 0.02, 0.08, 0.05, 0.06, 0.03, 0.05, 0.04, 0.07, 0.06, 0.07]","let bondReturns = [0.02, 0.03, 0.02, 0.03, 0.02, 0.03, 0.02, 0.03, 0.02, 0.03, 0.02, 0.03]","","let stockA = TimeSeries(periods: periods, values: stockAReturns)","let stockB = TimeSeries(periods: periods, values: stockBReturns)","let bonds = TimeSeries(periods: periods, values: bondReturns)","","let portfolio = Portfolio(","    assets: [\"Stock A\", \"Stock B\", \"Bonds\"],","    returns: [stockA, stockB, bonds],","    riskFreeRate: 0.02 \/ 12  \/\/ 2% annual = 0.167% monthly",")"],"type":"codeListing"},{"level":3,"text":"Optimizing for Maximum Sharpe Ratio","type":"heading","anchor":"Optimizing-for-Maximum-Sharpe-Ratio"},{"inlineContent":[{"type":"text","text":"The Sharpe ratio measures return per unit of risk. Higher is better."}],"type":"paragraph"},{"type":"codeListing","syntax":"swift","code":["\/\/ Find optimal weights that maximize risk-adjusted returns","let optimalAllocation = portfolio.optimizePortfolio()","","print(\"Optimal Portfolio:\")","print(\"  Expected Return: \\(optimalAllocation.expectedReturn * 12 * 100)% annually\")","print(\"  Risk (Volatility): \\(optimalAllocation.risk * sqrt(12) * 100)% annually\")","print(\"  Sharpe Ratio: \\(optimalAllocation.sharpeRatio)\")","","print(\"\\nOptimal Weights:\")","for (asset, weight) in zip(portfolio.assets, optimalAllocation.weights) {","    print(\"  \\(asset): \\(weight * 100)%\")","}"]},{"type":"heading","anchor":"Calculating-Portfolio-Metrics","text":"Calculating Portfolio Metrics","level":3},{"type":"codeListing","syntax":"swift","code":["\/\/ For any allocation, calculate risk and return","let customWeights = [0.40, 0.30, 0.30]  \/\/ 40% Stock A, 30% Stock B, 30% Bonds","","let customReturn = portfolio.portfolioReturn(weights: customWeights)","let customRisk = portfolio.portfolioRisk(weights: customWeights)","let customSharpe = portfolio.sharpeRatio(weights: customWeights)","","print(\"\\nCustom Allocation (40\/30\/30):\")","print(\"  Expected Return: \\(customReturn * 12 * 100)% annually\")","print(\"  Risk: \\(customRisk * sqrt(12) * 100)% annually\")","print(\"  Sharpe Ratio: \\(customSharpe)\")"]},{"type":"heading","anchor":"Efficient-Frontier","text":"Efficient Frontier","level":2},{"type":"paragraph","inlineContent":[{"text":"The efficient frontier shows all optimal portfolios - those with maximum return for each risk level.","type":"text"}]},{"type":"heading","anchor":"Generating-the-Frontier","text":"Generating the Frontier","level":3},{"type":"codeListing","syntax":"swift","code":["let efficientFrontier = portfolio.efficientFrontier(points: 20)","","print(\"Efficient Frontier:\")","print(\"Risk (σ) | Return (μ) | Sharpe\")","print(\"---------|------------|-------\")","","for allocation in efficientFrontier {","    let annualReturn = allocation.expectedReturn * 12 * 100","    let annualRisk = allocation.risk * sqrt(12) * 100","","    print(String(format: \"%6.2f%% | %8.2f%% | %6.3f\",","                 annualRisk, annualReturn, allocation.sharpeRatio))","}"]},{"type":"heading","anchor":"Finding-Specific-Points","text":"Finding Specific Points","level":3},{"type":"codeListing","syntax":"swift","code":["\/\/ Minimum risk portfolio","let minRiskAllocation = efficientFrontier.min(by: { $0.risk < $1.risk })!","print(\"\\nMinimum Risk Portfolio:\")","print(\"  Risk: \\(minRiskAllocation.risk * sqrt(12) * 100)%\")","print(\"  Return: \\(minRiskAllocation.expectedReturn * 12 * 100)%\")","","\/\/ Maximum Sharpe ratio (optimal)","let maxSharpeAllocation = efficientFrontier.max(by: { $0.sharpeRatio < $1.sharpeRatio })!","print(\"\\nMaximum Sharpe Portfolio:\")","print(\"  Sharpe Ratio: \\(maxSharpeAllocation.sharpeRatio)\")","print(\"  Risk: \\(maxSharpeAllocation.risk * sqrt(12) * 100)%\")","print(\"  Return: \\(maxSharpeAllocation.expectedReturn * 12 * 100)%\")"]},{"type":"heading","anchor":"Risk-Parity-Allocation","text":"Risk Parity Allocation","level":2},{"type":"paragraph","inlineContent":[{"type":"text","text":"Risk parity allocates capital so each asset contributes equally to portfolio risk, rather than focusing on returns."}]},{"type":"heading","anchor":"Equal-Risk-Contribution","text":"Equal Risk Contribution","level":3},{"type":"codeListing","syntax":"swift","code":["let riskParityOptimizer = RiskParityOptimizer<Double>()","","let riskParityAllocation = riskParityOptimizer.optimize(","    assets: portfolio.assets,","    returns: [stockA, stockB, bonds]",")","","print(\"\\nRisk Parity Allocation:\")","for (asset, weight) in zip(riskParityAllocation.assets, riskParityAllocation.weights) {","    print(\"  \\(asset): \\(weight * 100)%\")","}","","\/\/ Verify equal risk contributions","let riskContributions = riskParityOptimizer.calculateRiskContributions(","    allocation: riskParityAllocation",")","","print(\"\\nRisk Contributions:\")","for (asset, contribution) in zip(riskParityAllocation.assets, riskContributions) {","    print(\"  \\(asset): \\(contribution * 100)% of total risk\")","}"]},{"type":"heading","anchor":"When-to-Use-Risk-Parity","text":"When to Use Risk Parity","level":3},{"type":"paragraph","inlineContent":[{"text":"Risk parity is appropriate when:","type":"text"}]},{"type":"unorderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"text":"You believe risk, not return, is the key driver of portfolio performance","type":"text"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"You want diversification across all positions"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"You’re skeptical of return forecasts but confident in risk estimates"}]}]}]},{"type":"paragraph","inlineContent":[{"text":"Traditional Markowitz is better when:","type":"text"}]},{"type":"unorderedList","items":[{"content":[{"inlineContent":[{"text":"You have strong return forecasts","type":"text"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"You want to maximize risk-adjusted returns","type":"text"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Some assets clearly dominate others"}]}]}]},{"anchor":"Practical-Portfolio-Construction","text":"Practical Portfolio Construction","level":2,"type":"heading"},{"anchor":"Rebalancing","text":"Rebalancing","level":3,"type":"heading"},{"code":["\/\/ Check how far current allocation drifts from target","func needsRebalancing(","    current: [Double],","    target: [Double],","    threshold: Double = 0.05  \/\/ 5% threshold",") -> Bool {","    for (curr, targ) in zip(current, target) {","        if abs(curr - targ) > threshold {","            return true","        }","    }","    return false","}","","let currentWeights = [0.45, 0.28, 0.27]  \/\/ After market moves","let targetWeights = [0.40, 0.30, 0.30]","","if needsRebalancing(current: currentWeights, target: targetWeights) {","    print(\"Rebalancing needed:\")","    for i in 0..<currentWeights.count {","        let diff = (currentWeights[i] - targetWeights[i]) * 100","        print(\"  \\(portfolio.assets[i]): \\(diff > 0 ? \"+\" : \"\")\\(diff)%\")","    }","}"],"syntax":"swift","type":"codeListing"},{"anchor":"Constraints","text":"Constraints","level":3,"type":"heading"},{"code":["\/\/ Real-world portfolios have constraints","struct PortfolioConstraints {","    let minWeight: Double  \/\/ Minimum per asset","    let maxWeight: Double  \/\/ Maximum per asset","    let minBonds: Double   \/\/ Minimum in \"safe\" assets","}","","let constraints = PortfolioConstraints(","    minWeight: 0.05,   \/\/ At least 5% in each","    maxWeight: 0.50,   \/\/ At most 50% in each","    minBonds: 0.20     \/\/ At least 20% in bonds",")","","\/\/ Custom optimization with constraints","func optimizeWithConstraints(","    portfolio: Portfolio<Double>,","    constraints: PortfolioConstraints",") -> PortfolioAllocation<Double> {","    \/\/ Start with feasible allocation","    var weights = [0.40, 0.40, 0.20]","","    \/\/ Iteratively improve while respecting constraints","    \/\/ (Simplified - real implementation uses Lagrange multipliers)","","    return PortfolioAllocation(","        assets: portfolio.assets,","        weights: weights,","        expectedReturn: portfolio.portfolioReturn(weights: weights),","        risk: portfolio.portfolioRisk(weights: weights),","        sharpeRatio: portfolio.sharpeRatio(weights: weights)","    )","}"],"syntax":"swift","type":"codeListing"},{"anchor":"Understanding-Correlations","text":"Understanding Correlations","level":2,"type":"heading"},{"inlineContent":[{"type":"text","text":"Correlation drives diversification benefits."}],"type":"paragraph"},{"anchor":"Calculating-Correlations","text":"Calculating Correlations","level":3,"type":"heading"},{"code":["let correlationMatrix = portfolio.correlationMatrix()","","print(\"Correlation Matrix:\")","print(\"        Stock A  Stock B  Bonds\")","for (i, asset) in portfolio.assets.enumerated() {","    print(asset, terminator: \"\")","    for j in 0..<portfolio.assets.count {","        print(String(format: \" %7.3f\", correlationMatrix[i][j]), terminator: \"\")","    }","    print()","}"],"syntax":"swift","type":"codeListing"},{"anchor":"Diversification-Benefits","text":"Diversification Benefits","level":3,"type":"heading"},{"code":["\/\/ Compare diversified portfolio to individual assets","let equalWeights = [1.0\/3.0, 1.0\/3.0, 1.0\/3.0]","let portfolioRisk = portfolio.portfolioRisk(weights: equalWeights)","","let avgIndividualRisk = mean(portfolio.expectedReturns.map { stdDev($0.valuesArray) })","","let diversificationBenefit = (avgIndividualRisk - portfolioRisk) \/ avgIndividualRisk","","print(\"Diversification reduces risk by \\(diversificationBenefit * 100)%\")"],"syntax":"swift","type":"codeListing"},{"anchor":"Next-Steps","text":"Next Steps","level":2,"type":"heading"},{"items":[{"content":[{"type":"paragraph","inlineContent":[{"text":"Explore ","type":"text"},{"identifier":"doc:\/\/com.jpurnell.BusinessMath\/documentation\/BusinessMath\/RealOptionsGuide","isActive":true,"type":"reference"},{"text":" for valuing strategic flexibility in investments","type":"text"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Learn "},{"type":"reference","identifier":"doc:\/\/com.jpurnell.BusinessMath\/documentation\/BusinessMath\/RiskAnalyticsGuide","isActive":true},{"type":"text","text":" for comprehensive portfolio risk analysis"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"See ","type":"text"},{"type":"reference","identifier":"doc:\/\/com.jpurnell.BusinessMath\/documentation\/BusinessMath\/ScenarioAnalysisGuide","isActive":true},{"text":" for stress testing portfolios","type":"text"}]}]}],"type":"unorderedList"}],"kind":"content"}],"references":{"doc://com.jpurnell.BusinessMath/documentation/BusinessMath/LeaseAccountingGuide":{"kind":"article","role":"article","title":"Lease Accounting (IFRS 16 \/ ASC 842)","identifier":"doc:\/\/com.jpurnell.BusinessMath\/documentation\/BusinessMath\/LeaseAccountingGuide","abstract":[{"type":"text","text":"Model lease liabilities, right-of-use assets, and lease accounting under modern standards."}],"url":"\/documentation\/businessmath\/leaseaccountingguide","type":"topic"},"doc://com.jpurnell.BusinessMath/documentation/BusinessMath/InvestmentAnalysis":{"abstract":[{"type":"text","text":"Evaluate investment opportunities using NPV, IRR, and other financial metrics."}],"url":"\/documentation\/businessmath\/investmentanalysis","role":"article","kind":"article","title":"Investment Analysis","type":"topic","identifier":"doc:\/\/com.jpurnell.BusinessMath\/documentation\/BusinessMath\/InvestmentAnalysis"},"doc://com.jpurnell.BusinessMath/documentation/BusinessMath/EquityFinancingGuide":{"identifier":"doc:\/\/com.jpurnell.BusinessMath\/documentation\/BusinessMath\/EquityFinancingGuide","type":"topic","title":"Equity Financing and Cap Table Modeling","kind":"article","url":"\/documentation\/businessmath\/equityfinancingguide","abstract":[{"type":"text","text":"Model startup financing rounds, cap tables, SAFEs, convertible notes, and liquidation scenarios."}],"role":"article"},"doc://com.jpurnell.BusinessMath/documentation/BusinessMath":{"identifier":"doc:\/\/com.jpurnell.BusinessMath\/documentation\/BusinessMath","type":"topic","title":"BusinessMath","url":"\/documentation\/businessmath","kind":"article","abstract":[{"text":"A comprehensive Swift library for business mathematics, time series analysis, and financial modeling.","type":"text"}],"role":"collection"},"doc://com.jpurnell.BusinessMath/documentation/BusinessMath/ForecastingGuide":{"kind":"article","role":"article","title":"Time Series Forecasting","identifier":"doc:\/\/com.jpurnell.BusinessMath\/documentation\/BusinessMath\/ForecastingGuide","abstract":[{"type":"text","text":"Predict future values using statistical forecasting methods with BusinessMath."}],"url":"\/documentation\/businessmath\/forecastingguide","type":"topic"},"doc://com.jpurnell.BusinessMath/documentation/BusinessMath/BuildingRevenueModel":{"kind":"article","role":"article","title":"Building a Revenue Forecasting Model","identifier":"doc:\/\/com.jpurnell.BusinessMath\/documentation\/BusinessMath\/BuildingRevenueModel","abstract":[{"type":"text","text":"Create a complete revenue forecast with trend analysis and seasonality."}],"url":"\/documentation\/businessmath\/buildingrevenuemodel","type":"topic"},"doc://com.jpurnell.BusinessMath/documentation/BusinessMath/RealOptionsGuide":{"identifier":"doc:\/\/com.jpurnell.BusinessMath\/documentation\/BusinessMath\/RealOptionsGuide","type":"topic","url":"\/documentation\/businessmath\/realoptionsguide","title":"Real Options Valuation","abstract":[{"type":"text","text":"Value strategic flexibility and managerial decisions using option pricing theory."}],"kind":"article","role":"article"},"doc://com.jpurnell.BusinessMath/documentation/BusinessMath/BuildingFinancialReports":{"abstract":[{"type":"text","text":"Create comprehensive financial reports with operational metrics, period summaries, and trend analysis."}],"url":"\/documentation\/businessmath\/buildingfinancialreports","role":"article","kind":"article","title":"Building Multi-Period Financial Reports","type":"topic","identifier":"doc:\/\/com.jpurnell.BusinessMath\/documentation\/BusinessMath\/BuildingFinancialReports"},"doc://com.jpurnell.BusinessMath/documentation/BusinessMath/DebtAndFinancingGuide":{"identifier":"doc:\/\/com.jpurnell.BusinessMath\/documentation\/BusinessMath\/DebtAndFinancingGuide","type":"topic","url":"\/documentation\/businessmath\/debtandfinancingguide","title":"Debt & Financing Models","abstract":[{"type":"text","text":"Learn how to model debt instruments, capital structure, equity financing, covenants, and lease accounting."}],"kind":"article","role":"article"},"doc://com.jpurnell.BusinessMath/documentation/BusinessMath/ScenarioAnalysisGuide":{"identifier":"doc:\/\/com.jpurnell.BusinessMath\/documentation\/BusinessMath\/ScenarioAnalysisGuide","type":"topic","title":"Scenario & Sensitivity Analysis","url":"\/documentation\/businessmath\/scenarioanalysisguide","abstract":[{"type":"text","text":"Learn how to model multiple scenarios and analyze which inputs have the greatest impact on your outcomes."}],"kind":"article","role":"article"},"doc://com.jpurnell.BusinessMath/documentation/BusinessMath/OptimizationGuide":{"kind":"article","role":"article","title":"Optimization and Numerical Solvers","identifier":"doc:\/\/com.jpurnell.BusinessMath\/documentation\/BusinessMath\/OptimizationGuide","abstract":[{"type":"text","text":"Learn how to find optimal values and solve equations using BusinessMath’s optimization toolkit."}],"url":"\/documentation\/businessmath\/optimizationguide","type":"topic"},"doc://com.jpurnell.BusinessMath/documentation/BusinessMath/FinancialRatiosGuide":{"identifier":"doc:\/\/com.jpurnell.BusinessMath\/documentation\/BusinessMath\/FinancialRatiosGuide","type":"topic","title":"Financial Ratios & Metrics","url":"\/documentation\/businessmath\/financialratiosguide","abstract":[{"type":"text","text":"Learn how to analyze financial performance using key ratios and metrics."}],"kind":"article","role":"article"},"doc://com.jpurnell.BusinessMath/documentation/BusinessMath/FinancialStatementsGuide":{"kind":"article","role":"article","title":"Building Financial Statements","identifier":"doc:\/\/com.jpurnell.BusinessMath\/documentation\/BusinessMath\/FinancialStatementsGuide","abstract":[{"type":"text","text":"Learn how to model complete financial statements including Income Statement, Balance Sheet, and Cash Flow Statement."}],"url":"\/documentation\/businessmath\/financialstatementsguide","type":"topic"},"doc://com.jpurnell.BusinessMath/documentation/BusinessMath/LoanAmortization":{"kind":"article","role":"article","title":"Loan Amortization Analysis","identifier":"doc:\/\/com.jpurnell.BusinessMath\/documentation\/BusinessMath\/LoanAmortization","abstract":[{"type":"text","text":"Build a complete loan amortization schedule and analyze payment breakdowns."}],"url":"\/documentation\/businessmath\/loanamortization","type":"topic"},"doc://com.jpurnell.BusinessMath/documentation/BusinessMath/RiskAnalyticsGuide":{"abstract":[{"type":"text","text":"Measure and manage risk with comprehensive analytics and scenario testing."}],"url":"\/documentation\/businessmath\/riskanalyticsguide","role":"article","kind":"article","title":"Risk Analytics and Stress Testing","type":"topic","identifier":"doc:\/\/com.jpurnell.BusinessMath\/documentation\/BusinessMath\/RiskAnalyticsGuide"},"doc://com.jpurnell.BusinessMath/documentation/BusinessMath/VisualizationGuide":{"identifier":"doc:\/\/com.jpurnell.BusinessMath\/documentation\/BusinessMath\/VisualizationGuide","type":"topic","url":"\/documentation\/businessmath\/visualizationguide","title":"Command-Line Visualization","abstract":[{"type":"text","text":"Learn how to create visual representations of data directly in the terminal."}],"kind":"article","role":"article"}}}