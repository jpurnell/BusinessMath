# Lease Accounting (IFRS 16 / ASC 842)

Model lease liabilities, right-of-use assets, and lease accounting under modern standards.

## Overview

Under IFRS 16 and ASC 842, most leases must be capitalized on the balance sheet as a right-of-use (ROU) asset and lease liability. The ``Lease`` type provides comprehensive tools for:
- Calculating present value of lease payments with proper discount rates
- Generating amortization schedules for lease liabilities
- Computing ROU asset depreciation
- Handling short-term and low-value lease exemptions
- Modeling lease modifications and extensions
- Calculating sale-and-leaseback transactions

This guide walks through lease accounting from initial recognition through disposal.

## Understanding Lease Accounting Basics

### Key Concepts

Under modern lease accounting:
- **Lease Liability**: Present value of future lease payments, discounted at the appropriate rate
- **Right-of-Use Asset**: Initial lease liability plus initial direct costs and prepayments
- **Interest Expense**: Calculated on the outstanding lease liability balance
- **Depreciation**: ROU asset is depreciated over the shorter of lease term or asset life

### When to Capitalize Leases

All leases must be capitalized except:
- **Short-term leases**: 12 months or less
- **Low-value leases**: Underlying asset value < $5,000

## Basic Lease Recognition

Calculate the initial lease liability and ROU asset:

```swift
import BusinessMath

// Quarterly lease payments for office space
let q1 = Period.quarter(year: 2025, quarter: 1)
let periods = [q1, q1 + 1, q1 + 2, q1 + 3]  // 4 quarters = 1 year

let payments = TimeSeries(
    periods: periods,
    values: [25_000.0, 25_000.0, 25_000.0, 25_000.0]
)

// Create lease with 6% annual discount rate
let lease = Lease(
    payments: payments,
    discountRate: 0.06  // Incremental borrowing rate
)

// Calculate present value (lease liability)
let liability = lease.presentValue()
print("Initial lease liability: \(liability.currency())")  // ~$96,454

// Calculate right-of-use asset
let rouAsset = lease.rightOfUseAsset()
print("ROU asset: \(rouAsset.currency())")  // Same as liability initially
```

## Lease Liability Amortization Schedule

Generate a complete amortization schedule:

```swift
let schedule = lease.liabilitySchedule()

// Display schedule
for (period, balance) in schedule.sorted(by: { $0.key < $1.key }) {
	print("\(period.label): Balance \(balance.currency(0))")
}

// First period shows initial liability
// Subsequent periods show ending balance after payment
```

Detailed breakdown with interest and principal:

```swift
// Interest expense for first quarter
let interest1 = lease.interestExpense(period: q1)
print("Q1 Interest: \(interest1.currency())")  // Liability × (6% / 4)

// Principal reduction
let principal1 = lease.principalReduction(period: q1)
print("Q1 Principal: \(principal1.currency())")  // Payment - Interest

// Payment breakdown
let payment = 25_000.0
let totalExpense = interest1 + principal1
print("Total payment: \(payment.currency())")
```

## Initial Direct Costs and Prepayments

Include initial direct costs and prepayments in ROU asset:

```swift
let lease = Lease(
    payments: payments,
    discountRate: 0.08,
    initialDirectCosts: 5_000.0,  // Legal fees, commissions
    prepaidAmount: 10_000.0       // First month + security deposit
)

let liability = lease.presentValue()  // PV of payments only
let rouAsset = lease.rightOfUseAsset()  // PV + costs + prepayments

print("Lease liability: $\(liability)")
print("ROU asset: $\(rouAsset)")  // Higher than liability
```

## Depreciation of ROU Asset

Calculate straight-line depreciation:

```swift
// Depreciation per period (straight-line)
let depreciation = lease.depreciation(period: q1)
print("Q1 Depreciation: \(depreciation.currency())")  // ROU asset ÷ lease term

// Carrying value after each period
let carryingValue1 = lease.carryingValue(period: q1)
let carryingValue2 = lease.carryingValue(period: q1 + 1)
print("Q1 carrying value: \(carryingValue1.currency())")
print("Q2 carrying value: \(carryingValue2.currency())")  // Lower

```

## Income Statement Impact

Complete P&L impact each period:

```swift
// Interest expense (financing cost)
let interest = lease.interestExpense(period: q1)

// Depreciation expense (operating expense)
//	let depreciation = lease.depreciation(period: q1)

// Total P&L impact
let interestAndDepreciation = interest + depreciation
print("Q1 Total Expense: \(interestAndDepreciation.currency(0))")

// Note: Expense is front-loaded (higher interest early)
// Compare to straight-line rent expense under old standard
```

## Discount Rate Selection

### Implicit Rate in the Lease

If known, use the rate implicit in the lease:

```swift
// Usually only known for lessor
let lease = Lease(
    payments: payments,
    discountRate: 0.055,  // Rate implicit in lease
    discountRateType: .implicitRate
)
```

### Incremental Borrowing Rate

Most lessees use their incremental borrowing rate (IBR):

```swift
// Calculate IBR
let ibr = calculateIncrementalBorrowingRate(
    riskFreeRate: 0.03,        // Treasury rate
    creditSpread: 0.02,        // Company's credit spread
    assetRiskPremium: 0.005    // Asset-specific risk
)
print("IBR: \(ibr.percent())")  // 5.5%

let lease = Lease(
    payments: payments,
    discountRate: ibr,
    discountRateType: .incrementalBorrowingRate
)
```

### Impact of Discount Rate

Higher discount rates reduce present value:

```swift
let lowRate = Lease(payments: payments, discountRate: 0.04)
let highRate = Lease(payments: payments, discountRate: 0.10)

print("PV at \(lowRate.discountRate.percent()): \(lowRate.presentValue().currency())")   // Higher PV
print("PV at \(highRate.discountRate.percent()): \(highRate.presentValue().currency())")  // Lower PV
```

## Short-Term Lease Exemption

Leases of 12 months or less can be expensed:

```swift
let shortTermLease = Lease(
    payments: payments,
    discountRate: 0.06,
    leaseTerm: .months(12)  // Explicitly specify term
)

if shortTermLease.isShortTerm {
    print("Qualifies for short-term exemption")
    // Can expense payments as incurred
    // No ROU asset or liability
}

// When exemption applied:
let rouAsset = shortTermLease.rightOfUseAsset()  // Returns 0
let schedule = shortTermLease.liabilitySchedule()  // Returns zeros
```

## Low-Value Lease Exemption

Leases of assets < $5,000 can be expensed:

```swift
let lowValueLease = Lease(
    payments: payments,
    discountRate: 0.06,
    underlyingAssetValue: 4_500.0  // Below $5K threshold
)

if lowValueLease.isLowValue {
    print("Qualifies for low-value exemption")
    // Can expense payments as incurred
}
```

## Variable Lease Payments

Handle variable payments separately:

```swift
// Fixed minimum payments
let fixedPayments = TimeSeries(
	periods: periods,
	values: [20_000.0, 20_000.0, 20_000.0, 20_000.0]
)

// Variable payments (e.g., based on sales)
let variablePayments = TimeSeries(
	periods: periods,
	values: [3_000.0, 5_000.0, 4_500.0, 6_000.0]
)

let leaseFixedPayments = Lease(
	payments: fixedPayments,
	discountRate: 0.07,
	variablePayments: variablePayments
)

// Only fixed payments in liability
let liabilityFixedPayments = leaseFixedPayments.presentValue()  // PV of fixed portion only

// Total cash payment includes variable component
let totalCash = leaseFixedPayments.totalCashPayment(period: periods[0])
print("Total Q1 payment: \(totalCash.currency())")  // Fixed + variable
```

## Lease Modifications

### Extension

Extend the lease term:

```swift
let originalLease = Lease(
	payments: payments,
	discountRate: 0.06
)

// Extend by 2 more quarters
let extensionPayments = TimeSeries(
	periods: [q1 + 4, q1 + 5],
	values: [26_000.0, 26_000.0]
)

let extendedLease = originalLease.extend(
	additionalPayments: extensionPayments
)

let originalROU = originalLease.rightOfUseAsset()
let newROU = extendedLease.rightOfUseAsset()
print("ROU increase: \((newROU - originalROU).currency())")
```

### Rent Reduction

Modify payment amounts (e.g., COVID rent relief):

```swift
// Reduced payments for next 2 quarters
let reducedPayments = TimeSeries(
    periods: [q1, q1 + 1],
    values: [15_000.0, 15_000.0]  // Down from $25,000
)

let modifiedLease = originalLease.modify(
    newPayments: reducedPayments,
    atPeriod: q1
)

// Remeasure lease liability and ROU asset
```

## Lease vs Buy Analysis

Evaluate whether to lease or purchase:

```swift
// Lease option
let leasePV = leasePaymentsPV(
	periodicPayment: 5_000.0,
	periods: 60,  // 5 years monthly
	discountRate: 0.006  // Monthly rate
)

// Buy option
let buyPV = buyAssetPV(
	purchasePrice: 250_000.0,
	salvageValue: 50_000.0,
	holdingPeriod: 5,
	discountRate: 0.075,
	maintenanceCost: 2_000.0  // Annual
)

let analysis = LeaseVsBuyAnalysis(leasePV: leasePV, buyPV: buyPV)

if analysis.shouldLease {
	print("Recommendation: \(analysis.recommendation)")
	print("Savings: \(analysis.savingsPercentage.percent())")
} else {
	print("Buying is more economical")
}
```

## Sale and Leaseback Transactions

Model selling an asset and leasing it back:

```swift
let assetCarryingValue = 500_000.0
let salePrice = 600_000.0

let leasebackPayments = TimeSeries(
	periods: periods,
	values: [40_000.0, 40_000.0, 40_000.0, 40_000.0]
)

let transaction = SaleAndLeaseback(
	carryingValue: assetCarryingValue,
	salePrice: salePrice,
	leasebackPayments: leasebackPayments,
	discountRate: 0.06,
	startDate: q1.startDate
)

// Gain recognition
let gainRecognized = transaction.recognizedGain()
let deferredGain = transaction.deferredGain()

print("Recognized gain: \(gainRecognized.currency())")
print("Deferred gain: \(deferredGain.currency())")

// Cash benefit
let cashBenefit = transaction.netCashBenefit
print("Net cash from transaction: \(cashBenefit.currency())")

// Economic analysis
if transaction.isEconomicallyBeneficial {
	print("Transaction creates value")
}
```

## Finance vs Operating Lease Classification

Determine lease type under ASC 842:

```swift
let classification = classifyLease(
    leaseTerm: 48,           // months
    assetUsefulLife: 60,     // months
    presentValue: 90_000.0,
    assetFairValue: 100_000.0,
    ownershipTransfer: false,
    purchaseOption: false
)

switch classification {
case .finance:
    print("Finance lease")
    // Depreciation + interest expense
case .operating:
    print("Operating lease")
    // Single lease expense (straight-line)
}
```

Classification tests:
- Ownership transfers at end
- Purchase option reasonably certain
- Lease term ≥ 75% of useful life
- PV of payments ≥ 90% of fair value
- Asset has no alternative use

## Complete Lease Example

Here's a comprehensive lease accounting scenario:

```swift
import BusinessMath

// Office lease: 5 years, quarterly payments
let startDate = Period.quarter(year: 2025, quarter: 1)
let periodsOffice = (0..<20).map { startDate + $0 }  // 20 quarters

// Fixed rent with 3% annual escalation
var paymentsOffice: [Double] = []
let baseRent = 30_000.0
for i in 0..<20 {
	let yearIndex = i / 4
	let escalatedRent = baseRent * pow(1.03, Double(yearIndex))
	paymentsOffice.append(escalatedRent)
}

let paymentSeries = TimeSeries(periods: periodsOffice, values: paymentsOffice)

// Create lease with costs
let leaseOffice = Lease(
	payments: paymentSeries,
	discountRate: 0.068,  // 6.8% IBR
	initialDirectCosts: 15_000.0,  // Broker commission
	prepaidAmount: 30_000.0,       // First quarter rent
	depreciationMethod: .straightLine,
	leaseTerm: .years(5),
	underlyingAssetValue: 2_000_000.0  // Office space value
)

// Initial recognition
let liabilityOffice = leaseOffice.presentValue()
let rouAssetOffice = leaseOffice.rightOfUseAsset()

print("=== Initial Recognition ===")
print("Lease liability: \(liabilityOffice.currency(2))")
print("ROU asset: \(rouAssetOffice.currency(2))")

// First year expense breakdown
print("\n=== Year 1 Expenses ===")
for i in 0..<4 {
	let period = periodsOffice[i]
	let interest = leaseOffice.interestExpense(period: period)
	let depreciation = leaseOffice.depreciation(period: period)
	let total = interest + depreciation

	print("\(period.label): Interest \(interest.currency()), " +
		  "Depreciation \(depreciation.currency()), " +
		 "Total \(total.currency())")
}

// Maturity analysis for disclosure
print("\n=== Payment Maturity Analysis ===")
let maturityOffice = leaseOffice.maturityAnalysis()
for (year, amount) in maturityOffice.sorted(by: { $0.key < $1.key }) {
	print("\(year): \(amount.currency())")
}

// Total commitment disclosure
let totalPayments = lease.totalFuturePayments()
print("\nTotal future lease payments: $\(String(format: "%.0f", totalPayments))")
print("Present value: $\(String(format: "%.0f", liability))")
print("Implicit interest: $\(String(format: "%.0f", totalPayments - liability))")
```

## Disclosure Requirements

Key disclosures for lease accounting:

```swift
// Total commitments
let totalCommitments = lease.totalFuturePayments()

// Weighted average discount rate
let effectiveRate = lease.effectiveRate

// Weighted average remaining term
// (calculate from payment schedule)

// Maturity analysis
let maturity = lease.maturityAnalysis()

// Expense breakdown
let currentPeriod = Period.quarter(year: 2025, quarter: 1)
let interest = lease.interestExpense(period: currentPeriod)
let depreciation = lease.depreciation(period: currentPeriod)
```

## Common Patterns

### Monthly Lease with Annual Payments

```swift
// Annual payments but monthly periods for reporting
let year2025 = Period.year(2025)
let annualPayment = 120_000.0

// Convert to monthly equivalent
let months = year2025.months()
let monthlyPayment = annualPayment / 12.0

let monthlyPayments = TimeSeries(
    periods: months,
    values: Array(repeating: monthlyPayment, count: 12)
)

let lease = Lease(
    payments: monthlyPayments,
    discountRate: 0.06  // Will be converted to monthly rate automatically
)
```

### Residual Value Guarantees

```swift
let lease = Lease(
    payments: payments,
    discountRate: 0.07,
    residualValue: 20_000.0  // Guaranteed residual at end
)

// Residual value increases lease liability
let liabilityWithResidual = lease.presentValue()
```

### Leasehold Improvements

```swift
// ROU asset + leasehold improvements
let rouAsset = lease.rightOfUseAsset()
let improvements = 50_000.0
let totalAsset = rouAsset + improvements

// Depreciate over shorter of lease term or improvement life
```

## Next Steps

- Explore <doc:3.14-DebtAndFinancingGuide> for modeling debt obligations and capital structure
- Learn about <doc:3.5-FinancialStatementsGuide> for integrating leases into complete financial statements
- Review <doc:1.3-TimeValueOfMoney> for understanding present value calculations

## See Also

- ``Lease``
- ``SaleAndLeaseback``
- ``LeaseVsBuyAnalysis``
- ``LeaseClassification``
- ``LeaseTerm``
- ``DepreciationMethod``
