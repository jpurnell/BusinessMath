//: [Previous](@previous)

import Foundation
import BusinessMath

// Simple Example: Minimize portfolio variance with no short-selling
// Problem: Minimize w'Cw subject to Σw = 1, w ≥ 0

let covariance = [
	[0.04, 0.01, 0.02],
	[0.01, 0.09, 0.03],
	[0.02, 0.03, 0.16]
]

// Objective: Minimize portfolio variance
let portfolioVariance: (VectorN<Double>) -> Double = { weights in
	var variance = 0.0
	for i in 0..<3 {
		for j in 0..<3 {
			variance += weights[i] * covariance[i][j] * weights[j]
		}
	}
	return variance
}

// Constraints:
// 1. Budget: Σw = 1 (equality)
// 2. No short-selling: w ≥ 0 (inequalities)
let constraints: [MultivariateConstraint<VectorN<Double>>] = [
	.budgetConstraint  // Σw = 1
] + MultivariateConstraint<VectorN<Double>>.nonNegativity(dimension: 3)  // w ≥ 0

// Initial guess: equal weights
let initial = VectorN([1.0/3, 1.0/3, 1.0/3])

let optimizer = InequalityOptimizer<VectorN<Double>>()
let result = try optimizer.minimize(
	portfolioVariance,
	from: initial,
	subjectTo: constraints
)

print("Optimal portfolio:")
for (i, w) in result.solution.toArray().enumerated() {
	print("  Asset \(i+1): \(w.percent(1))")
}
print("Portfolio variance: \(result.objectiveValue.number(6))")
print("Portfolio volatility: \((sqrt(result.objectiveValue).percent(1)))")
print("Converged: \(result.converged)")//: [Next](@next)
